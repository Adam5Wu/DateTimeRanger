/**
 * datetimeranger
 * @version v1.0.1
 * @link https://adam5wu.github.io/DateTimeRanger/
 * @license MIT
 */
!function(e){"function"==typeof define&&define.amd?define(["jquery","moment","daterange-picker-ex","timedropper-ex"],e):"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("jquery"),require("moment"),require("daterange-picker-ex"),require("timedropper-ex")):e(jQuery,moment)}(function(e,t){"use strict";e.fn.dateTimeRanger=function(a){function n(){function n(t){if(!t.validity.valid){for(var a in t.validity)if(t.validity[a]){e(t).attr("title","Invalid value: "+a.replace(/[A-Z]/g,function(e,t){return"-"+e.toLowerCase()}));break}return e(t).addClass("invalid"),a}e(t).removeClass("invalid"),e(t).removeAttr("title")}function r(e,t,a){clearTimeout(h),y[e]=[t,a],h=setTimeout(function(){h=null;for(var e in y){var t=y[e];t[1](t[0])}y={}},200)}function s(e,t,a){e.validity.valid?u(C.selRange)&&w(["internal","range-reverse"],[!0,!0]):(w(["picker",t],a,!0),n(e))}function l(e,t,a,r){switch(e){case 13:if(!t.validity.valid)return w(["picker",a],r,!0),void n(t);t.focusNext.focus();break;case 27:var i="";r[0]&&(C.selRange.start=!1,i+="start"),r[1]&&(C.selRange.end=!1,i+="end"),w(["internal","clear-"+i],r),n(t)}}var o=i(C.locale),c=o[0];C.fblocalizer=o[1];var p=C.locale;if(a.language)a.language in e.DTRLang&&(p=a.language);else{var f=navigator.languages||navigator.userLanguage||(navigator.language?[navigator.language]:[navigator.browserLanguage]);for(var g in f){var m=f[g].toLowerCase();if(m in e.DTRLang){p=m;break}}}o=i(p),C.locale=o[0],C.localizer=o[1];var _=C.formatter.locale();a.language&&C.formatter.locale(a.language).locale()===a.language||C.formatter.locale(C.locale).locale()!==C.locale&&C.formatter.locale(p).locale()!==p&&C.formatter.locale(c).locale()!==c&&C.formatter.locale(_),C.wrapper=F(e(".dt-ranger").length),(a.container||C.anchor).append(C.wrapper),C.el.default_bar=C.wrapper.find(".default-bar"),C.el.summary_bar=C.wrapper.find(".summary-bar"),C.el.summary_start=C.el.summary_bar.find(".start-dt"),C.el.summary_end=C.el.summary_bar.find(".end-dt"),C.el.summary_span=C.el.summary_bar.find(".span-days"),C.el.oper_zone=C.wrapper.find(".oper-zone"),C.el.start_zone=C.el.oper_zone.find(".start-zone"),C.el.start_inputs=C.el.start_zone.find("input"),C.el.start_input_date=C.el.start_zone.find("input.date"),C.el.start_input_time=C.el.start_zone.find("input.time"),C.el.start_pickers=C.el.start_zone.find(".pickers"),C.el.end_zone=C.el.oper_zone.find(".end-zone"),C.el.end_inputs=C.el.end_zone.find("input"),C.el.end_input_date=C.el.end_zone.find("input.date"),C.el.end_input_time=C.el.end_zone.find("input.time"),C.el.end_pickers=C.el.end_zone.find(".pickers"),C.start_datepicker=C.el.start_pickers.dateRangePicker({inline:!0,alwaysOpen:!0,autoCloase:!0,watchValueChange:!1,language:a.language,getValue:function(){},setValue:function(e){},container:C.el.start_pickers,singleMonth:!0,singleDate:!0,haveTopbar:!1,startOfWeek:a.startOfWeek,dateRange:a.dateRange,minDays:a.minDays,maxDays:a.maxDays,showWeekNumbers:a.showWeekNumbers,getWeekNumber:a.getWeekNumber,beforeShowDay:a.showDayFilter}).data("DRPEx"),C.start_timepicker=C.el.start_pickers.timeDropper({inline:!0,alwaysOpen:!0,watchValueChange:!1,language:a.language,fetchTime:function(){},putTime:function(e){},startFrom:null,container:C.el.start_pickers,autoSwitch:a.autoSwitch,meridians:a.meridians,mousewheel:a.mousewheel,showLancets:a.showLancets,handleShake:a.handleShake,stickyMinute:a.stickyMinute,stickyHour:a.stickyHour}).data("TDEx"),C.end_datepicker=C.el.end_pickers.dateRangePicker({inline:!0,alwaysOpen:!0,autoCloase:!0,watchValueChange:!1,language:a.language,getValue:function(){},setValue:function(e){},container:C.el.end_pickers,singleMonth:!0,singleDate:!0,lookBehind:!0,haveTopbar:!1,startOfWeek:a.startOfWeek,dateRange:a.dateRange,minDays:a.minDays,maxDays:a.maxDays,showWeekNumbers:a.showWeekNumbers,getWeekNumber:a.getWeekNumber,beforeShowDay:a.showDayFilter}).data("DRPEx"),C.end_timepicker=C.el.end_pickers.timeDropper({inline:!0,alwaysOpen:!0,watchValueChange:!1,language:a.language,fetchTime:function(){},putTime:function(e){},startFrom:null,container:C.el.end_pickers,autoSwitch:a.autoSwitch,meridians:a.meridians,mousewheel:a.mousewheel,showLancets:a.showLancets,handleShake:a.handleShake,stickyMinute:a.stickyMinute,stickyHour:a.stickyHour}).data("TDEx");var h=null,y={};C.el.start_pickers.on("DRPEx-apply",function(e,t){v("picker",t.date),a.autoSwitch&&setTimeout(function(){C.start_timepicker.select(a.startFrom)},0),C.selDelay&&clearTimeout(C.selDelay),C.selDelay=setTimeout(function(){C.selDelay=null},100)}),C.el.start_pickers.on("TDEx-update",function(e,t){t.now&&y["start-time"]||k("picker",t.time[0],t.now)}),C.el.start_input_date.on("input",function(e){r("start-date",this,function(e){var a=n(e);if(!a){var r=e.valueAsDate,i=t(new Date(r.getUTCFullYear(),r.getUTCMonth(),r.getUTCDate())).toDate();v("input",i)}})}),C.el.start_input_time.on("input",function(e){r("start-time",this,function(e){var t=n(e);t||k("input",e.valueAsNumber/1e3,!1)})}),C.el.end_pickers.on("DRPEx-apply",function(e,t){R("picker",t.date),a.autoSwitch&&setTimeout(function(){C.end_timepicker.select(a.startFrom)},0),C.selDelay&&clearTimeout(C.selDelay),C.selDelay=setTimeout(function(){C.selDelay=null},100)}),C.el.end_pickers.on("TDEx-update",function(e,t){t.now&&y["end-time"]||D("picker",t.time[0],t.now)}),C.el.end_input_date.on("input",function(e){r("end-date",this,function(e){var a=n(e);if(!a){var r=e.valueAsDate,i=t(new Date(r.getUTCFullYear(),r.getUTCMonth(),r.getUTCDate())).toDate();R("input",i)}})}),C.el.end_input_time.on("input",function(e){r("end-time",this,function(e){var t=n(e);t||D("input",e.valueAsNumber/1e3,!1)})}),C.el.start_input_date.on("blur",function(e){s(this,"date",[!0,!1])}),C.el.start_input_date.attr("focusNext",C.el.start_input_time),C.el.start_input_time.on("blur",function(e){s(this,"time",[!0,!1])}),C.el.start_input_time.attr("focusNext",C.el.end_input_date),C.el.end_input_date.on("blur",function(e){s(this,"date",[!1,!0])}),C.el.end_input_date.attr("focusNext",C.el.end_input_time),C.el.end_input_time.on("blur",function(e){s(this,"time",[!1,!0])}),C.el.end_input_time.attr("focusNext",C.el.start_input_time),C.el.start_zone.on("click",function(e){d(e,C.el.start_inputs[0])||d(e,C.el.start_inputs[1])||d(e,C.el.start_pickers[0])||C.el.start_input_date[0].focus()}),C.el.start_zone.on("mouseenter",function(e){C.el.start_input_date[0].focus()}),C.el.end_zone.on("click",function(e){d(e,C.el.end_inputs[0])||d(e,C.el.end_inputs[1])||d(e,C.el.end_pickers[0])||C.el.end_input_date[0].focus()}),C.el.end_zone.on("mouseenter",function(e){C.el.end_input_date[0].focus()}),C.el.start_input_date.on("keyup",function(e){l(e.keyCode,this,"date",[!0,!1])}),C.el.start_input_time.on("keyup",function(e){l(e.keyCode,this,"time",[!0,!1])}),C.el.end_input_date.on("keyup",function(e){l(e.keyCode,this,"date",[!1,!0])}),C.el.end_input_time.on("keyup",function(e){l(e.keyCode,this,"time",[!1,!0])})}function r(e){if(!C.wrapper){if(void 0!==C.wrapper)throw new Error("Already destroyed");if(e)throw new Error("Not yet initialized")}}function i(t){for(var a=e.DTRLang[t];a.constructor===String;)t=a,a=e.DTRLang[a];return[t,a]}function s(e){return C.localizer[e]||C.fblocalizer[e]||"??"}function l(e){return e.start&&e.end?t(e.start).isAfter(t(e.end)):null}function o(e){if(l(e)){var t=e.end;return e.end=e.start,e.start=t,!0}return!1}function u(e){if(o(e)){var t=C.followTime.start;return C.followTime.start=C.followTime.end,C.followTime.end=t,!0}return!1}function d(e,t){return t.contains(e.target)||e.target==t}function c(e){C.selDelay||d(e,C.anchor[0])||d(e,C.wrapper[0])||f(a.animationTime)}function p(t){if(!C.active){C.active=!0,C.el.oper_zone.css({display:"block",visibility:0}),C.start_datepicker.redraw(),C.end_datepicker.redraw(),C.el.oper_zone.css({display:"none",visibility:"initial"});var n=function(){C.anchor.trigger("DTR-opened",{anchor:C.anchor,wrapper:C.wrapper})};return C.el.default_bar.slideUp(t),C.el.summary_bar.slideUp(t),C.el.oper_zone.slideDown(t,n),a.alwaysOpen||e(document).bind("click.DTR",c),C.anchor.trigger("DTR-open",{anchor:C.anchor,wrapper:C.wrapper}),!0}return!1}function f(t){if(!a.alwaysOpen&&C.active){C.active=!1;var n=function(){C.anchor.trigger("DTR-closed",{anchor:C.anchor,wrapper:C.wrapper})};return u(C.selRange)&&w(["internal","range-reverse"],[!0,!0]),C.selRange.start&&C.selRange.end?C.el.summary_bar.slideDown(t):C.el.default_bar.slideDown(t),C.el.oper_zone.slideUp(t,n),C.anchor.trigger("DTR-close",{anchor:C.anchor,wrapper:C.wrapper}),a.alwaysOpen||e(document).unbind("click.DTR",c),!0}return!1}function g(e,a,n,r){var i=null,s=null;if(e){var l=t(e).format("YYYY-MM-DDTHH:mm");i=l.substr(0,10),s=l.substr(11,5)}a&&a.val(i),n&&(n.val(s),r&&s?n.addClass("floating"):n.removeClass("floating"))}function m(e,t){if(e){var a=3600*e.getHours()+60*e.getMinutes()+e.getSeconds()+e.getMilliseconds()/1e3;t.setTime(a)}else t.setTime(null)}function _(e,a){if(e){var n=t(e[0]).startOf("day").toDate(),r=t(e[1]).startOf("day").toDate();a.forEach(function(e){e.setRange(n,r,!0)})}else a.forEach(function(e){e.clear(!0)})}function h(e,t){return C.formatter.toDate().setTime(e),C.formatter.format(t)}function w(e,n,r){var i=!0;if(n[0]){switch(e[0]){case"picker":switch(e[1]){case"time":i=!C.el.start_input_date.val();default:g(C.selRange.start,"date"!=e[1]&&C.el.start_input_date.val()?null:C.el.start_input_date,"time"!=e[1]&&C.el.start_input_time.val()?null:C.el.start_input_time,C.followTime.start)}break;case"input":switch(e[1]){case"time":m(C.selRange.start,C.start_timepicker),C.el.start_input_date.val()||g(C.selRange.start,C.el.start_input_date,null),i=!1;break;case"date":C.el.start_input_time.val()||g(C.selRange.start,null,C.el.start_input_time,C.followTime.start)}break;default:g(C.selRange.start,C.el.start_input_date,C.el.start_input_time,C.followTime.start),m(!C.followTime.start&&C.selRange.start,C.start_timepicker)}var s=h(C.selRange.start,a.summaryFmt);C.el.summary_start.text(s)}if(n[1]){switch(e[0]){case"picker":switch(e[1]){case"time":i=!C.el.end_input_date.val();default:g(C.selRange.end,"date"!=e[1]&&C.el.end_input_date.val()?null:C.el.end_input_date,"time"!=e[1]&&C.el.end_input_time.val()?null:C.el.end_input_time,C.followTime.start)}break;case"input":switch(e[1]){case"time":m(C.selRange.end,C.end_timepicker),C.el.end_input_date.val()||g(C.selRange.end,C.el.end_input_date,null),i=!1;break;case"date":C.el.end_input_time.val()||g(C.selRange.end,null,C.el.end_input_time,C.followTime.start)}break;default:g(C.selRange.end,C.el.end_input_date,C.el.end_input_time,C.followTime.start),m(!C.followTime.end&&C.selRange.end,C.end_timepicker)}var s=h(C.selRange.end,a.summaryFmt);C.el.summary_end.text(s)}if(i&&(C.selRange.start?C.selRange.end?_([C.selRange.start,C.selRange.end],[C.start_datepicker,C.end_datepicker]):(_([C.selRange.start,C.selRange.start],[C.start_datepicker]),_(!1,[C.end_datepicker])):C.selRange.end?(_(!1,[C.start_datepicker]),_([C.selRange.end,C.selRange.end],[C.end_datepicker])):_(!1,[C.start_datepicker,C.end_datepicker])),C.selRange.start&&C.selRange.end){var l=t(C.selRange.end).diff(C.selRange.start,"day",!0);C.el.summary_span.text(Math.abs(Math.round(100*l)/100))}if(!r){var o={source:e};C.selRange.start&&(o.start=new Date(C.selRange.start)),C.selRange.end&&(o.end=new Date(C.selRange.end)),C.anchor.trigger("DTR-change",o)}}function v(e,t){var a=!1,n=C.selRange.start;if(!n){a=!0,n=C.selRange.start=new Date;var r=C.start_timepicker.getTime();n.setHours(Math.floor(r[0]/3600));var i=r[0]%3600;n.setMinutes(Math.floor(i/60)),n.setSeconds(0),n.setMilliseconds(0)}a||(a=n.getFullYear()!=t.getFullYear()||n.getMonth()!=t.getMonth()||n.getDate()!=t.getDate()),a&&(n.setFullYear(t.getFullYear()),n.setMonth(t.getMonth()),n.setDate(t.getDate()),w([e,"date"],[!0,u(C.selRange)]))}function k(e,t,a){var n=C.followTime.start!=a;C.followTime.start=a;var r=C.selRange.start;if(!r){if(a)return;n=!0,r=C.selRange.start=new Date;var i=C.start_datepicker.getDateRange();i&&(r.setFullYear(i[1].getFullYear()),r.setMonth(i[1].getMonth()),r.setDate(i[1].getDate()))}var s=Math.floor(t/3600),l=t%3600,o=Math.floor(l/60),d=0,c=0;n||(n=r.getHours()!=s||r.getMinutes()!=o||r.getSeconds()!=d||r.getMilliseconds()!=c),n&&(r.setHours(s),r.setMinutes(o),r.setSeconds(d),r.setMilliseconds(c),w([e,"time"],[!0,u(C.selRange)]))}function y(e,t,a,n){C.selRange.start=t,C.followTime.start=a,w([e,"set-rangestart"],[!0,u(C.selRange)])}function R(e,t){var a=!1,n=C.selRange.end;if(!n){a=!0,n=C.selRange.end=new Date;var r=C.end_timepicker.getTime();n.setHours(Math.floor(r[0]/3600));var i=r[0]%3600;n.setMinutes(Math.floor(i/60)),n.setSeconds(0),n.setMilliseconds(0)}a||(a=n.getFullYear()!=t.getFullYear()||n.getMonth()!=t.getMonth()||n.getDate()!=t.getDate()),a&&(n.setFullYear(t.getFullYear()),n.setMonth(t.getMonth()),n.setDate(t.getDate()),w([e,"date"],[u(C.selRange),!0]))}function D(e,t,a){var n=C.followTime.end!=a;C.followTime.end=a;var r=C.selRange.end;if(!r){if(a)return;n=!0,r=C.selRange.end=new Date;var i=C.end_datepicker.getDateRange();i&&(r.setFullYear(i[1].getFullYear()),r.setMonth(i[1].getMonth()),r.setDate(i[1].getDate()))}var s=Math.floor(t/3600),l=t%3600,o=Math.floor(l/60),d=0,c=0;n||(n=r.getHours()!=s||r.getMinutes()!=o||r.getSeconds()!=d||r.getMilliseconds()!=c),n&&(r.setHours(s),r.setMinutes(o),r.setSeconds(d),r.setMilliseconds(c),w([e,"time"],[u(C.selRange),!0]))}function T(e,t,a,n){C.selRange.end=t,C.followTime.end=a,w([e,"set-rangeend"],[u(C.selRange),!0])}function b(e,t,a,n,r,i){C.selRange.start=t,C.followTime.start=a,C.selRange.end=n,C.followTime.end=r,u(C.selRange),w([e,"set-range"],[!0,!0])}function M(e,t){return!(!C.selRange.start&&!C.selRange.end)&&(C.selRange.start=!1,C.selRange.end=!1,w([e,"clear-selection"],[!0,!0]),!0)}function z(){C.start_input_date.resetView(),C.end_input_date.resetView()}function S(){C.start_input_date.redraw(),C.end_input_date.redraw()}function x(t,a,n){var r="<"+t;return a&&(e.each(a,function(e,t){t.constructor==Array&&(t=t.reduce(function(e,t){return(e||"")+(t?" "+t:"")})),r+=" "+e+'="'+t+'"'}),void 0!==n&&(r+=n?">"+n+"</"+t:"/")),r+">"}function F(t){var a=x("div",{"class":["dt-ranger"],id:"dt-ranger-"+t});return a+=x("div",{"class":"default-bar"},x("i",{"class":["fa","fa-hand-pointer-o"],"aria-hidden":"true"},"")+s("select")),a+=x("div",{"class":"summary-bar"},x("span",{},s("from"))+" "+x("b",{"class":"start-dt"},"[start datetime]")+" "+x("span",{},s("to"))+" "+x("b",{"class":"end-dt"},"[end datetime]")+" "+x("i",{},"("+x("span",{"class":"span-days"},"X")+" "+s("days")+")")),a+=x("div",{"class":"oper-zone"},x("div",{"class":"start-zone"},x("label",{},s("start")+":"+x("div",{"class":"input-wrapper"},x("input",{"class":"date",type:"date",min:"2000-01-01",max:"3000-01-01"})+x("input",{"class":"time",type:"time"})))+x("div",{"class":"pickers"},""))+x("div",{"class":"end-zone"},x("label",{},s("end")+":"+x("div",{"class":"input-wrapper"},x("input",{"class":"date",type:"date",min:"2000-01-01",max:"3000-01-01"})+x("input",{"class":"time",type:"time"})))+x("div",{"class":"pickers"},""))),a+=x("/div"),e(a)}e.DTRLang=e.extend({"default":"en",en:{from:"From",to:"To",days:"Days",select:"Please pick a date time range",start:"Start",end:"End"}},e.DTRLang),a=e.extend({autoStart:!1,alwaysOpen:!1,dropTrigger:!0,summaryFmt:"LLL",minDispFmt:"YYYY/M/D H:mm",language:void 0,startOfWeek:void 0,dateRange:{start:!1,end:!1},minDays:0,maxDays:0,container:void 0,showWeekNumbers:!1,getWeekNumber:function(e){return t(e).format("w")},showDayFilter:void 0,autoSwitch:!0,meridians:!0,mousewheel:!0,showLancets:!0,startFrom:"hr",handleShake:!1,stickyMinute:20,stickyHour:480},a),a.dateRange.start&&a.dateRange.start.constructor==String&&(a.dateRange.start=t(a.dateRange.start,a.format).toDate()),a.dateRange.end&&a.dateRange.end.constructor==String&&(a.dateRange.end=t(a.dateRange.end,a.format).toDate()),a.alwaysOpen&&(a.autoStart=!0,a.dropTrigger=!1),o(a.dateRange);var C={anchor:e(this),wrapper:void 0,el:{},locale:"default",localizer:{},fblocalizer:{},formatter:t(),selRange:{start:!1,end:!1},followTime:{start:!1,end:!1},selDelay:null,active:!1};return C.anchor.data("DTR",{open:function(e){return r(),p(e)},close:function(e){return r(),f(e)},setStart:function(e,n,i){return r(!0),e.constructor==String&&(e=t(e,a.format).toDate()),y("api",e,n,i),this},setEnd:function(e,n,i){return r(!0),e.constructor==String&&(e=t(e,a.format).toDate()),T("api",e,n,i),this},setRange:function(e,n,i,s,l){r(!0),e.constructor==String&&(e=t(e,a.format).toDate()),i.constructor==String&&(i=t(i,a.format).toDate()),b("api",e,n,i,s,l)},clear:function(e){return r(),M("api",e)},wrapper:function(){return r(!0),C.wrapper},anchor:function(){return r(),C.anchor},redraw:function(){r(),C.wrapper&&S()},resetMonthsView:function(){r(),C.wrapper&&z()},isActive:function(){return r(),C.active},destroy:function(){r(),C.anchor.trigger("DTR-destroy",{}),C.anchor.off("click"),C.anchor.data("DTR",void 0),C.wrapper&&C.wrapper.remove(),C.wrapper=null,e(document).off("click",c)}}),a.dropTrigger&&C.anchor.on("click",function(e){p(a.animationTime)}),a.alwaysOpen&&setTimeout(p.bind(this),0),n(),this}});